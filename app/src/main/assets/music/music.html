<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音乐播放器</title>
    <link rel="stylesheet" href="/music/music.css">
    <script src="/music/shared.js"></script>
    <style>

    </style>
</head>

<body>
    <div class="wrapper"></div>

    <audio></audio>
    <script>
        const baseUri = window.location.host === "127.0.0.1:5500" ? "http://192.168.8.55:3000" : "";
        const path = new URL(window.location).searchParams.get("path") || "%2Fstorage%2Femulated%2F0%2FMusics%2FMP3%2F%E9%98%BF%E6%82%A0%E6%82%A0-%E4%B8%80%E6%9B%B2%E7%9B%B8%E6%80%9D.mp3";
        async function loadMusicFiles() {
            let dir = substringBeforeLast(decodeURIComponent(path), "/");
            const res = await fetch(`${baseUri}/api/files?path=${encodeURIComponent(dir)}`);
            return res.json();
        }
        async function render() {
            const files = (await loadMusicFiles())
            .filter(x=>!x.is_directory);
            const buf = [];
            for (const iterator of files) {
                buf.push(`<div class="item-wrapper" data-path="${iterator.path}">
        <div class="item-left">
        </div>
        <div class="item-main">
            <div class="item-title">${substringBeforeLast(substringAfterLast(iterator.path, "/"), ".")}</div>
            <div class="item-subtitle"></div>
        </div>
        <div class="item-right"></div>
    </div>`);
            }
            wrapper.innerHTML = buf.join('');
        }
        const wrapper = document.querySelector('.wrapper');


        render();
    </script>
</body>

</html>